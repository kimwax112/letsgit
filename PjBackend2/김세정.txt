CREATE TABLE wishlist_client (
    wish_id NUMBER PRIMARY KEY,  -- 찜 고유 번호 
    client_id VARCHAR2(3000) NOT NULL,  -- 의뢰인 ID
    postnum NUMBER(38) NOT NULL,  -- 찜한 포트폴리오의 POSTNUM. 
    designer_id NUMBER(38) NOT NULL,  -- 디자이너 ID (새로 추가) 
    created_at  DATE DEFAULT SYSDATE,  -- 찜한 시간. 
    CONSTRAINT fk_postnum FOREIGN KEY (postnum) REFERENCES posts(postnum)
);
-> 의뢰인이 찜한 디자이너를 저장하기 위해 테이블 생성



CREATE SEQUENCE wishlist_client_seq
  START WITH 1
  INCREMENT BY 1
  NOCACHE
  NOCYCLE;
-> 찜 고유번호를 자동 증가 시키기위해 생성한 시퀀스



CREATE TABLE request_messages (
    id              NUMBER PRIMARY KEY,
    contract_id     NUMBER REFERENCES contracts(contract_id),
    client_id       VARCHAR2(50),  
    designer_id     VARCHAR2(50), 
    content         CLOB,
    sent_time       DATE DEFAULT SYSDATE,
    is_read         CHAR(1) DEFAULT 'N'
);
-> 의뢰인이 수정요청을 보냈을 때 해당 내용을 저장하기 위한 테이블

 
CREATE SEQUENCE REQUEST_MESSAGES_SEQ
START WITH 1
INCREMENT BY 1
NOMAXVALUE
NOCYCLE
NOCACHE;
->request_messages의 id를 자동 증가 시키기 위해 생성한 시퀀스

 
CREATE OR REPLACE TRIGGER TRG_REQUEST_MESSAGES_ID
BEFORE INSERT ON REQUEST_MESSAGES
FOR EACH ROW
BEGIN
  IF :NEW.ID IS NULL THEN
    SELECT REQUEST_MESSAGES_SEQ.NEXTVAL
    INTO :NEW.ID
    FROM DUAL;
  END IF;
END;
-> 시퀀스 사용을 위한 트리거    



6/7

CREATE TABLE contract_progress (
  id NUMBER PRIMARY KEY,
  contract_id NUMBER NOT NULL,
  step NUMBER NOT NULL,
  created_at DATE DEFAULT SYSDATE
);
-> 디자이너가 작업 진행도를 변경하고 의뢰인이 조회 할 수 있도록 작업 진행도를 저장하는 테이블


CREATE SEQUENCE seq_progress_id
START WITH 1
INCREMENT BY 1
NOCACHE
NOCYCLE;

-> 진행내역 id를 자동 증가하도록 시퀀스 생성





6/8

CREATE SEQUENCE requestId_seq
  START WITH 1
  INCREMENT BY 1
  NOCACHE
  NOCYCLE;



CREATE OR REPLACE TRIGGER trg_request_id
BEFORE INSERT ON request
FOR EACH ROW
BEGIN
  :NEW.request_id := requestId_seq.NEXTVAL;
END;
-> 의뢰 id를 자동 증가 시키기 위한 시퀀스+트리거



CREATE TABLE request (
    request_id NUMBER PRIMARY KEY,
    title VARCHAR2(255),
    category_tags VARCHAR2(255),
    style VARCHAR2(255),
    amount VARCHAR2(255),
    deadline VARCHAR2(255),
    description CLOB,
    image1_url VARCHAR2(255),
    image2_url VARCHAR2(255),
    image3_url VARCHAR2(255)
);
-> 의뢰인이 올린 의뢰를 저장하는 테이블



CREATE TABLE favorite (
    id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    designer_id VARCHAR2(200) NOT NULL,
    request_id NUMBER NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-> 디자이너가 의뢰인이 올린 의뢰 찜하는 기능
오라클 버전에 따라  id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY, 이 구문이 실행이 안될 수도 있음 그떄는 밑에 있는 시퀀스+트리거 조합으로 생성해주시면 됩니다.


CREATE SEQUENCE favorite_seq START WITH 1 INCREMENT BY 1;


CREATE OR REPLACE TRIGGER trg_favorite_id
BEFORE INSERT ON favorite
FOR EACH ROW
WHEN (NEW.id IS NULL)
BEGIN
    SELECT favorite_seq.NEXTVAL INTO :NEW.id FROM dual;
END;  




 6/10 

<!!! user_info 테이블과 조인하기 위해서 데이터 타입을 맞춰야 함 favorite 테이블의 designer_id가 number이면 밑에 4단계를 통해 데이터 타입을 VARCHAR2으로 바꿔주세요>
 -- 1. 임시 컬럼 생성 (VARCHAR2 타입)
ALTER TABLE favorite ADD (designer_id_tmp VARCHAR2(200));

-- 2. 기존 designer_id 값을 문자열로 변환하여 임시 컬럼에 복사
UPDATE favorite SET designer_id_tmp = TO_CHAR(designer_id);

-- 3. 기존 컬럼 삭제
ALTER TABLE favorite DROP COLUMN designer_id;

-- 4. 임시 컬럼 이름을 designer_id로 변경
ALTER TABLE favorite RENAME COLUMN designer_id_tmp TO designer_id;




6/17 
ALTER TABLE request ADD username VARCHAR2(200);  --의뢰 아이템 박스에 username표시하기 위해 추가했습니다. 
